{"version":3,"sources":["webpack:///./src/views/backoffice/EditarArtista.vue","webpack:///./src/views/backoffice/EditarArtista.vue?922e"],"names":["route","useRoute","tempArtista","ref","artista","reactive","nombre","banner","data","tempData","biografia","albumes","fecha_lanzamiento","cover","canciones","duracion","interprete","async","handleSubmit","storage","getStorage","storageRef","firebaseRef","coversAlbumes","replaceAll","toLowerCase","map","album","index","file","Promise","all","then","docRef","doc","apolusFirebase","value","id","updateDoc","console","log","addNewAlbum","push","addNewSong","i","handleAlbumCover","event","url","filePreviewFromInput","target","files","handleBanner","res","collection","params","get","empty","Error","err","watch","newValue","oldValue","__exports__"],"mappings":"+7CA0HE,MAAMA,EAAQC,iBAERC,EAAcC,eAAI,MAClBC,EAAUC,eAAS,CACvBC,OAAQ,KACRC,OAAQ,CACNC,KAAM,KACNC,SAAU,MAEZC,UAAW,GACXC,QAAS,CACP,CACEL,OAAQ,KACRM,kBAAmB,KACnBC,MAAO,CACLL,KAAM,KACNC,SAAU,MAEZK,UAAW,CACT,CACER,OAAQ,KACRS,SAAU,KACVC,WAAY,WAOtBC,eAAeC,IAEb,MAAMC,EAAUC,iBACVC,EAAaC,eAAYH,EAAS,YAKlCI,GAJaD,eAAYD,EAAYjB,EAAQE,OAAOkB,WAAW,IAAK,KAAKC,eAIzDrB,EAAQO,QAAQe,IAAIT,MAAOU,EAAOC,KAEnDD,EAAMd,MAAML,KAAKqB,cAQhBC,QAAQC,IAAIR,GAAeS,KAAMf,UAErC,MAAMgB,EAASC,eAAIC,eAAe,WAAWjC,EAAYkC,MAAMC,UAEzDC,eAAUL,EAAQ,CAAEtB,QAASP,EAAQO,UAE3C4B,QAAQC,IAAI,oCAwBhB,SAASC,IACPrC,EAAQO,QAAQ+B,KAAK,CACnBpC,OAAQ,KACRM,kBAAmB,KACnBC,MAAO,CACLL,KAAM,KACNC,SAAU,MAEZK,UAAW,CACT,CACER,OAAQ,KACRS,SAAU,SAMlB,SAAS4B,EAAWC,GAClBxC,EAAQO,QAAQiC,GAAG9B,UAAU4B,KAAK,CAChCpC,OAAQ,KACRS,SAAU,OAIdE,eAAe4B,EAAiBC,EAAOF,GACrCxC,EAAQO,QAAQiC,GAAG/B,MAAML,KAAO,CAC9BuC,UAAWC,eAAqBF,GAChCjB,KAAMiB,EAAMG,OAAOC,MAAM,IAK7BjC,eAAekC,EAAaL,GAC1B1C,EAAQG,OAAOE,SAAW,CACxBsC,UAAWC,eAAqBF,GAChCjB,KAAMiB,EAAMG,OAAOC,MAAM,I,OAvD7B,iBACE,IACE,IAAIE,QAAYjB,eAAekB,WAAW,YAAYnB,IAAIlC,EAAMsD,OAAOjB,IAAIkB,MAE3E,GAAKH,EAAII,MASF,MAAMC,MAAM,4BATH,CACdlB,QAAQC,IAAIY,EAAIf,IAChB,MAAM7B,EAAO4C,EAAI5C,OAEjBN,EAAYkC,MAAQ,IACf5B,EAAM6B,GAAIe,EAAIf,IAGnBE,QAAQC,IAAItC,EAAYkC,QAG5B,MAAMsB,GACJnB,QAAQC,IAAIkB,IAhBhB,GA2DAC,eAAMzD,EAAY,CAAC0D,EAAUC,KACxBD,IACDxD,EAAQE,OAASsD,EAAStD,OAC1BF,EAAQG,OAAOE,SAAWmD,EAASrD,OAAOC,KAC1CJ,EAAQM,UAAYkD,EAASlD,UAC7BN,EAAQO,QAAUiD,EAASjD,W,2uFChPjC,MAAMmD,EAAc,EAEL","file":"js/chunk-2d0c9548.ea5de943.js","sourcesContent":["<template>\r\n  <div style=\"max-width: 700px; margin: auto;\">\r\n    <h1><strong>Editar Artista</strong></h1>\r\n    <form>\r\n    <!-- NOMBRE -->\r\n    <div class=\"mb-3\">\r\n      <label class=\"form-label\" for=\"nombreArtista\">Nombre</label>\r\n      <input \r\n        class=\"form-control\" \r\n        type=\"text\" \r\n        id=\"nombreArtista\" \r\n        v-model=\"artista.nombre\"\r\n      />\r\n    </div>\r\n    <!-- BIOGRAFIA -->\r\n    <div class=\"mb-3\">\r\n      <label class=\"form-label\" for=\"bioArtista\">Biografia</label>\r\n      <textarea \r\n        class=\"form-control\" \r\n        type=\"text\" \r\n        id=\"bioArtista\" \r\n        v-model=\"artista.biografia\"\r\n      >\r\n      </textarea>\r\n    </div>\r\n    <!-- BANNER -->\r\n    <div class=\"mb-3\">\r\n      <label class=\"form-label\">Banner</label>\r\n      <input \r\n        class=\"form-control\" \r\n        type=\"file\" \r\n        @change=\"handleBanner($event)\"\r\n      />\r\n      <img \r\n        class=\"img-fluid my-3\" \r\n        v-if=\"artista.banner.tempData\"\r\n        :src=\"artista.banner.tempData.url\" \r\n      />\r\n    </div>\r\n    <!--ALBUM-->\r\n    <div class=\"mb-4\" v-for=\"(album, i) in artista.albumes\">\r\n      <h4><strong>Álbum</strong></h4>\r\n      <!-- NOMBRE ALBUM -->\r\n      <div class=\"mb-3\">\r\n        <label class=\"form-label\">Nombre</label>\r\n        <input class=\"form-control\" type=\"text\" v-model=\"album.nombre\" >\r\n      </div>\r\n      <!-- FECHA DE LANZAMIENTO ALBUM -->\r\n      <div class=\"mb-3\">\r\n        <label class=\"form-label\">Fecha de lanzamiento</label>\r\n        <input \r\n          class=\"form-control\" \r\n          type=\"text\" \r\n          v-model=\"album.fecha_lanzamiento\"\r\n        />\r\n      </div>\r\n      <!-- COVER ALBUM -->\r\n      <div class=\"mb-3\">\r\n        <label class=\"form-label\"> Caratula </label>\r\n        <input \r\n          class=\"form-control\" \r\n          type=\"file\" \r\n          @change=\"handleAlbumCover($event, i)\"\r\n        />\r\n      </div>\r\n      <img \r\n        class=\"img-fluid my-3\" \r\n        v-if=\"album.cover.data\"\r\n        :src=\"album.cover.data.url\" \r\n        />\r\n      <!-- CANCIONES -->\r\n      <div class=\"canciones\">\r\n        <h5>Canciones</h5>\r\n        <div class=\"form-cancion mb-2\" v-for=\"(cancion, indexCancion) in album.canciones\">\r\n          <div class=\"row\">\r\n            <div class=\"col-lg-1 pe-0 align-self-center\">\r\n              <span>{{ indexCancion + 1 }}</span>\r\n            </div>\r\n            <div class=\"col-lg-5 ps-0\">\r\n              <input \r\n                class=\"form-control\" \r\n                v-model=\"cancion.nombre\"\r\n                type=\"text\" \r\n                placeholder=\"Nombre\" \r\n              />\r\n            </div>\r\n            <div class=\"col-lg-4 ps-0\">\r\n              <input \r\n                class=\"form-control\" \r\n                v-model=\"cancion.interprete\"\r\n                type=\"text\" \r\n                placeholder=\"Interpretes\"\r\n              />\r\n            </div>\r\n            <div class=\"col-lg-2\">\r\n              <input \r\n                class=\"form-control\" \r\n                v-model=\"cancion.duracion\"\r\n                type=\"text\" \r\n                placeholder=\"Duración\" \r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <button class=\"btn btn-secondary btn-sm ms-auto d-block\" @click.prevent=\"addNewSong(i)\"> Añadir nueva canción</button>\r\n      </div>\r\n      <hr>\r\n    </div>\r\n    <button class=\"btn btn-secondary btn-md ms-auto d-block\" @click.prevent=\"addNewAlbum\"> Añadir nuevo álbum</button>\r\n    <button class=\"btn btn-primary ms-auto d-block mt-5\" @click.prevent=\"handleSubmit\" type=\"submit\">Guardar Artista</button>\r\n  </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { useRoute} from \"vue-router\"\r\n  import {reactive, ref, watch} from \"vue\"\r\n  import { db } from \"../../firebase/config\"\r\n  import {addDoc, collection, updateDoc, doc } from \"firebase/firestore\"\r\n  import { getStorage, ref as firebaseRef, uploadBytes, getMetadata, getDownloadURL } from \"firebase/storage\";\r\n  import {filePreviewFromInput} from \"../../composables/filePreview\"\r\n\r\n  const route = useRoute()\r\n\r\n  const tempArtista = ref(null)\r\n  const artista = reactive({\r\n    nombre: null,\r\n    banner: {\r\n      data: null,\r\n      tempData: null,\r\n    },\r\n    biografia: \"\",\r\n    albumes: [\r\n      {\r\n        nombre: null,\r\n        fecha_lanzamiento: null,\r\n        cover: {\r\n          data: null,\r\n          tempData: null,\r\n        },\r\n        canciones: [\r\n          {\r\n            nombre: null,\r\n            duracion: null,\r\n            interprete: null,\r\n          }\r\n        ]\r\n      }\r\n    ]\r\n  })\r\n\r\n  async function handleSubmit() {\r\n\r\n    const storage = getStorage()\r\n    const storageRef = firebaseRef(storage, 'artistas')\r\n    const projectRef = firebaseRef(storageRef, artista.nombre.replaceAll(' ', '-').toLowerCase())\r\n\r\n\r\n  \r\n    const coversAlbumes = artista.albumes.map(async (album, index) => {\r\n\r\n      if(album.cover.data.file) {\r\n\r\n      } else {\r\n    \r\n      }\r\n\r\n    }) \r\n\r\n    await Promise.all(coversAlbumes).then( async () => {\r\n\r\n      const docRef = doc(apolusFirebase,\"artistas\",tempArtista.value.id)\r\n    \r\n      await updateDoc(docRef, { albumes: artista.albumes })\r\n\r\n      console.log('Artista actualizado con exito.')\r\n    })\r\n  }\r\n\r\n  ( async function obtenerArtista() {\r\n    try {\r\n      let res = await apolusFirebase.collection('artistas').doc(route.params.id).get()\r\n\r\n      if (!res.empty) {\r\n        console.log(res.id)\r\n        const data = res.data()\r\n\r\n        tempArtista.value = {\r\n          ...data, id: res.id\r\n        }\r\n\r\n        console.log(tempArtista.value)\r\n      } else throw Error('That post does not exist')\r\n    }\r\n    catch(err) {\r\n      console.log(err)\r\n    }\r\n  })()\r\n\r\n  function addNewAlbum() {\r\n    artista.albumes.push({\r\n      nombre: null,\r\n      fecha_lanzamiento: null,\r\n      cover: {\r\n        data: null,\r\n        tempData: null,\r\n      },\r\n      canciones: [\r\n        {\r\n          nombre: null,\r\n          duracion: null\r\n        }\r\n      ]\r\n    })\r\n  }\r\n\r\n  function addNewSong(i) {\r\n    artista.albumes[i].canciones.push({\r\n      nombre: null,\r\n      duracion: null\r\n    })\r\n  }\r\n\r\n  async function handleAlbumCover(event, i) {\r\n    artista.albumes[i].cover.data = {\r\n      url: await filePreviewFromInput(event),\r\n      file: event.target.files[0]\r\n    }\r\n    \r\n  }\r\n\r\n  async function handleBanner(event) {\r\n    artista.banner.tempData = {\r\n      url: await filePreviewFromInput(event),\r\n      file: event.target.files[0]\r\n    }\r\n  }\r\n\r\n  watch(tempArtista,(newValue, oldValue) => {\r\n    if(newValue) {\r\n      artista.nombre = newValue.nombre\r\n      artista.banner.tempData = newValue.banner.data\r\n      artista.biografia = newValue.biografia\r\n      artista.albumes = newValue.albumes\r\n    }\r\n  })\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\r\n</style>","import script from \"./EditarArtista.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./EditarArtista.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"sourceRoot":""}